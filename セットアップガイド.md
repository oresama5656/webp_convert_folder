# WebP自動変換システム セットアップガイド

## 概要
このシステムは、PNG/BMP/JPEGファイルを自動的にWebPフォーマットに変換するPowerShellスクリプトです。

## 必要な環境
- Windows 10/11
- PowerShell 5.1 以降
- 管理者権限（初回セットアップ時のみ）

## 1. 前提条件の確認

### PowerShellの実行ポリシー確認
```powershell
Get-ExecutionPolicy -Scope CurrentUser
```

もし `Restricted` の場合は、以下を実行してください：
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

## 2. 変換ツールの導入

### オプション A: ImageMagick（推奨）

1. [ImageMagick公式サイト](https://imagemagick.org/script/download.php#windows)から最新版をダウンロード
2. インストーラーを実行し、**「Install development headers and libraries for C and C++」にチェック**を入れる
3. インストール完了後、コマンドプロンプトで動作確認：
   ```cmd
   magick -version
   ```

#### Chocolatey を使用する場合：
```powershell
# Chocolatey未インストールの場合は先にインストール
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

# ImageMagickインストール
choco install imagemagick -y
```

### オプション B: Google WebP Tools

1. [Google WebP公式サイト](https://developers.google.com/speed/webp/download)から最新版をダウンロード
2. 適当なフォルダ（例：`C:\\webp`）に解凍
3. システム環境変数PATHに解凍先フォルダを追加
4. コマンドプロンプトで動作確認：
   ```cmd
   cwebp -version
   ```

## 3. スクリプトファイルの配置

1. すべてのファイルを適当なフォルダに配置（例：`C:\\WebP-Auto`）
2. 含まれるファイル：
   - `WebP-AutoConverter.ps1`（メインスクリプト）
   - `Install-TaskScheduler.ps1`（タスクスケジューラ登録用）
   - `セットアップガイド.md`（このファイル）
   - `トラブルシューティングガイド.md`
   - `設定例.md`

## 4. 初回テスト実行

### 手動テスト
```powershell
# スクリプトのフォルダに移動
cd "C:\\WebP-Auto"

# ヘルプ表示
.\\WebP-AutoConverter.ps1 -Help

# 一回限りの変換テスト
.\\WebP-AutoConverter.ps1 -OneTime
```

### 監視モードテスト
```powershell
# 監視モードで実行（Ctrl+Cで停止）
.\\WebP-AutoConverter.ps1
```

テスト用画像ファイルをダウンロードフォルダに保存し、自動的にWebPに変換されることを確認してください。

## 5. 自動起動の設定

### タスクスケジューラへの登録

1. PowerShellを**管理者として実行**
2. スクリプトフォルダに移動
3. 登録スクリプトを実行：
   ```powershell
   .\\Install-TaskScheduler.ps1
   ```

### 登録確認
```powershell
# タスクの状態確認
Get-ScheduledTask -TaskName "WebP Auto Converter"

# 手動でタスクを開始してテスト
Start-ScheduledTask -TaskName "WebP Auto Converter"
```

## 6. 設定のカスタマイズ

### 設定ファイルの場所
```
%LOCALAPPDATA%\\WebP-Auto\\config.json
```

### 基本的な設定項目
```json
{
  "WatchPaths": [
    "C:\\Users\\[ユーザー名]\\Downloads",
    "C:\\Users\\[ユーザー名]\\Pictures\\Screenshots"
  ],
  "JpegQuality": 95,
  "DeleteOriginal": true,
  "EnableNotifications": true
}
```

詳細な設定については `設定例.md` を参照してください。

## 7. ログの確認

### ログファイルの場所
```
%LOCALAPPDATA%\\WebP-Auto\\logs\\YYYY-MM-DD.log
```

### ログフォルダを開く
```powershell
# エクスプローラーでログフォルダを開く
explorer "$env:LOCALAPPDATA\\WebP-Auto\\logs"
```

## 8. 通知機能の向上（オプション）

より良い通知を受け取りたい場合は、BurntToastモジュールをインストール：

```powershell
Install-Module -Name BurntToast -Scope CurrentUser
```

## 9. アンインストール

### タスクスケジューラから削除
```powershell
.\\Install-TaskScheduler.ps1 -Uninstall
```

### 設定ファイルとログの削除
```powershell
Remove-Item "$env:LOCALAPPDATA\\WebP-Auto" -Recurse -Force
```

### スクリプトファイルの削除
手動でスクリプトフォルダを削除してください。

## よくある質問

### Q: スクリプトが動作しているか確認したい
A: タスクマネージャーでPowerShellプロセスを確認するか、ログファイルの更新時刻を確認してください。

### Q: 特定のフォルダだけ監視したい
A: 設定ファイルの `WatchPaths` を編集してください。

### Q: 変換品質を変更したい
A: 設定ファイルの `JpegQuality` を調整（0-100）してください。

### Q: 元ファイルを残したい
A: 設定ファイルの `DeleteOriginal` を `false` に変更してください。

## トラブルシューティング

問題が発生した場合は、`トラブルシューティングガイド.md` を参照してください。

---
**注意**: 初回セットアップ時は管理者権限が必要ですが、通常の実行では一般ユーザー権限で動作します。