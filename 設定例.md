# WebP自動変換システム 設定例

## 設定ファイルについて

設定ファイルは `%LOCALAPPDATA%\\WebP-Auto\\config.json` に自動作成されます。
初回実行時にデフォルト設定が作成され、その後は手動で編集可能です。

### 設定ファイルを開く方法
```powershell
# エクスプローラーで設定ファイルフォルダを開く
explorer "$env:LOCALAPPDATA\\WebP-Auto"

# 設定ファイルを直接編集（メモ帳）
notepad "$env:LOCALAPPDATA\\WebP-Auto\\config.json"

# 設定ファイルを直接編集（VSCode）
code "$env:LOCALAPPDATA\\WebP-Auto\\config.json"
```

## 基本設定項目

### 必須項目
```json
{
  "WatchPaths": ["監視するフォルダのパス"],
  "SupportedExtensions": [".png", ".jpg", ".jpeg", ".bmp"],
  "JpegQuality": 95,
  "LosslessPngBmp": true,
  "DeleteOriginal": true
}
```

### 全設定項目（デフォルト値）
```json
{
  "WatchPaths": [
    "C:\\Users\\[ユーザー名]\\Downloads",
    "C:\\Users\\[ユーザー名]\\Pictures\\Screenshots"
  ],
  "SupportedExtensions": [".png", ".jpg", ".jpeg", ".bmp"],
  "JpegQuality": 95,
  "LosslessPngBmp": true,
  "PreserveMetadata": true,
  "DeleteOriginal": true,
  "OriginalBackupFolder": "Originals",
  "EnableNotifications": true,
  "LogLevel": "INFO",
  "ProcessDelayMs": 1000,
  "PreventDuplicateProcessing": true,
  "ExcludePatterns": []
}
```

## 設定項目の詳細説明

| 項目名 | 型 | 説明 | 例 |
|--------|-----|------|-----|
| `WatchPaths` | string[] | 監視するフォルダのパス（複数指定可能） | `["C:\\Users\\User\\Downloads"]` |
| `SupportedExtensions` | string[] | 変換対象の拡張子 | `[".png", ".jpg", ".jpeg", ".bmp"]` |
| `JpegQuality` | int | JPEG変換時の品質（0-100） | `95` |
| `LosslessPngBmp` | bool | PNG/BMPを無劣化変換するか | `true` |
| `PreserveMetadata` | bool | メタデータを保持するか | `true` |
| `DeleteOriginal` | bool | 変換後に元ファイルを削除するか | `true` |
| `OriginalBackupFolder` | string | 元ファイルのバックアップフォルダ名 | `"Originals"` |
| `EnableNotifications` | bool | 通知を有効にするか | `true` |
| `LogLevel` | string | ログレベル（INFO/DEBUG/WARN/ERROR） | `"INFO"` |
| `ProcessDelayMs` | int | ファイル処理前の待機時間（ミリ秒） | `1000` |
| `PreventDuplicateProcessing` | bool | 重複処理を防止するか | `true` |
| `ExcludePatterns` | string[] | 除外パターン（ワイルドカード使用可） | `["*temp*", "*.tmp"]` |

## 用途別設定例

### 1. Downloadsフォルダのみ監視（基本設定）
```json
{
  "WatchPaths": ["C:\\Users\\[ユーザー名]\\Downloads"],
  "SupportedExtensions": [".png", ".jpg", ".jpeg", ".bmp"],
  "JpegQuality": 95,
  "LosslessPngBmp": true,
  "DeleteOriginal": true,
  "EnableNotifications": true,
  "LogLevel": "INFO"
}
```

### 2. Screenshotsフォルダのみ監視（高品質設定）
```json
{
  "WatchPaths": ["C:\\Users\\[ユーザー名]\\Pictures\\Screenshots"],
  "SupportedExtensions": [".png"],
  "LosslessPngBmp": true,
  "DeleteOriginal": false,
  "OriginalBackupFolder": "PNG-Originals",
  "EnableNotifications": false,
  "LogLevel": "INFO"
}
```

### 3. 複数フォルダ監視（バランス設定）
```json
{
  "WatchPaths": [
    "C:\\Users\\[ユーザー名]\\Downloads",
    "C:\\Users\\[ユーザー名]\\Pictures\\Screenshots",
    "C:\\Users\\[ユーザー名]\\Desktop"
  ],
  "SupportedExtensions": [".png", ".jpg", ".jpeg", ".bmp"],
  "JpegQuality": 90,
  "LosslessPngBmp": true,
  "DeleteOriginal": true,
  "EnableNotifications": true,
  "ProcessDelayMs": 2000,
  "ExcludePatterns": ["*thumbnail*", "*cache*"]
}
```

### 4. 元ファイル退避モード（安全重視）
```json
{
  "WatchPaths": ["C:\\Users\\[ユーザー名]\\Downloads"],
  "SupportedExtensions": [".png", ".jpg", ".jpeg", ".bmp"],
  "JpegQuality": 95,
  "LosslessPngBmp": true,
  "DeleteOriginal": false,
  "OriginalBackupFolder": "Originals",
  "PreserveMetadata": true,
  "EnableNotifications": true,
  "LogLevel": "INFO"
}
```

### 5. 高圧縮設定（容量重視）
```json
{
  "WatchPaths": ["C:\\Users\\[ユーザー名]\\Downloads"],
  "SupportedExtensions": [".png", ".jpg", ".jpeg", ".bmp"],
  "JpegQuality": 80,
  "LosslessPngBmp": false,
  "PreserveMetadata": false,
  "DeleteOriginal": true,
  "EnableNotifications": true,
  "LogLevel": "INFO"
}
```

### 6. デバッグ設定（トラブルシューティング用）
```json
{
  "WatchPaths": ["C:\\Users\\[ユーザー名]\\Downloads"],
  "SupportedExtensions": [".png", ".jpg", ".jpeg", ".bmp"],
  "JpegQuality": 95,
  "LosslessPngBmp": true,
  "DeleteOriginal": false,
  "OriginalBackupFolder": "Debug-Originals",
  "EnableNotifications": true,
  "LogLevel": "DEBUG",
  "ProcessDelayMs": 5000,
  "PreventDuplicateProcessing": true
}
```

### 7. 最小限設定（軽量動作）
```json
{
  "WatchPaths": ["C:\\Users\\[ユーザー名]\\Downloads"],
  "SupportedExtensions": [".png", ".jpg"],
  "JpegQuality": 85,
  "LosslessPngBmp": true,
  "DeleteOriginal": true,
  "PreserveMetadata": false,
  "EnableNotifications": false,
  "LogLevel": "ERROR",
  "ProcessDelayMs": 500
}
```

### 8. 特定ファイル除外設定
```json
{
  "WatchPaths": [
    "C:\\Users\\[ユーザー名]\\Downloads",
    "C:\\Users\\[ユーザー名]\\Pictures"
  ],
  "SupportedExtensions": [".png", ".jpg", ".jpeg", ".bmp"],
  "JpegQuality": 95,
  "DeleteOriginal": true,
  "ExcludePatterns": [
    "*thumbnail*",
    "*temp*",
    "*cache*",
    "*\\AppData\\*",
    "*\\.git\\*",
    "screenshot_*.png"
  ]
}
```

## カスタムパスの例

### よく使用されるフォルダパス
```json
{
  "WatchPaths": [
    "C:\\Users\\[ユーザー名]\\Downloads",
    "C:\\Users\\[ユーザー名]\\Desktop",
    "C:\\Users\\[ユーザー名]\\Pictures",
    "C:\\Users\\[ユーザー名]\\Pictures\\Screenshots",
    "C:\\Users\\[ユーザー名]\\OneDrive\\Pictures",
    "D:\\Images",
    "D:\\Downloads"
  ]
}
```

### ネットワークドライブの監視
```json
{
  "WatchPaths": [
    "\\\\server\\shared\\images",
    "Z:\\ProjectImages"
  ]
}
```

## 品質設定ガイド

### JPEG品質設定の目安
- **高品質**: 95-100（ファイルサイズ大、画質最高）
- **標準**: 85-95（バランス）
- **軽量**: 70-85（ファイルサイズ小、画質良好）
- **最軽量**: 50-70（ファイルサイズ最小、画質妥協）

### 用途別推奨設定
```json
// 写真・アートワーク用
{
  "JpegQuality": 95,
  "LosslessPngBmp": true,
  "PreserveMetadata": true
}

// ウェブ用画像
{
  "JpegQuality": 85,
  "LosslessPngBmp": false,
  "PreserveMetadata": false
}

// スクリーンショット用
{
  "JpegQuality": 90,
  "LosslessPngBmp": true,
  "PreserveMetadata": false
}
```

## 設定変更後の反映

設定を変更した後は、以下の方法で反映してください：

### 1. タスクの再起動
```powershell
# タスクを停止
Stop-ScheduledTask -TaskName "WebP Auto Converter"

# タスクを開始
Start-ScheduledTask -TaskName "WebP Auto Converter"
```

### 2. 手動実行でのテスト
```powershell
# 一回限りの実行でテスト
.\\WebP-AutoConverter.ps1 -OneTime

# 監視モードでテスト
.\\WebP-AutoConverter.ps1
```

## トラブルシューティング

### 設定ファイルの文法チェック
```powershell
try {
    $config = Get-Content "$env:LOCALAPPDATA\\WebP-Auto\\config.json" | ConvertFrom-Json
    Write-Host "設定ファイルは正常です" -ForegroundColor Green
    $config | ConvertTo-Json -Depth 10
} catch {
    Write-Host "設定ファイルにエラーがあります: $($_.Exception.Message)" -ForegroundColor Red
}
```

### 設定のリセット
```powershell
# 現在の設定をバックアップ
Copy-Item "$env:LOCALAPPDATA\\WebP-Auto\\config.json" "$env:LOCALAPPDATA\\WebP-Auto\\config.json.backup"

# 設定ファイルを削除（次回実行時にデフォルトが再作成される）
Remove-Item "$env:LOCALAPPDATA\\WebP-Auto\\config.json"
```

---
**注意**: 設定変更後は必ずテスト実行を行い、期待通りに動作することを確認してください。